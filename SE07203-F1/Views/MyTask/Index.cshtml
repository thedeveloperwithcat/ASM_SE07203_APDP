@*
    For more information on enabling MVC for empty projects, visit https://go.microsoft.com/fwlink/?LinkID=397860
*@
@{
}
@model List<MyTask>
<div class="container-fluid">
    <div class="card">
        <div class="card-body">
            <div class="row">
                <div class="col-4">
                     <a class="btn btn-outline-info w-100" href="@Url.Action("Create", "MyTask")">Create a new task</a>
                </div>
                <div class="col-4">
                </div>
                <div class="col-4">
                </div>
            </div>
            <div class="row">
                <div class="col-12">
                    <table class="table table-hover table-info table-striped">
                        <tr>
                            <th>
                                ID
                            </th>
                            <th>
                                Title
                            </th>
                            <th>
                                Details
                            </th>
                             <th>
                                 User
                            </th>
                            <th>
                                Category
                            </th>
                            <th>
                                Actions
                            </th>
                        </tr>
                        @if(Model != null && Model.Count > 0)
                        {
                            foreach (var t in Model)
                            {
                                <tr>
                                    <th>
                                        @(t?.GetType().GetProperty("Id")?.GetValue(t, null))
                                    </th>
                                    <th>
                                        @t.Title
                                        <input type="text" name="Title" value="@t.Title" />
                                    </th>
                                    <th>
                                        @t.Details
                                    </th>
                                    <th>
                                        @t?.AccountId
                                    </th>
                                    <th>
                                        @t?.CategoryName
                                        <input type="text" name="CategoryName" value="@(t?.CategoryName ?? string.Empty)" disabled class="form-control m-100" />
                                    </th>
                                    <th>
                                        <form action="Remove" asp-controller="MyTask" method="post">
                                            <input type="number" name="id" value="@(t?.GetType().GetProperty("Id")?.GetValue(t, null))" class="d-none" />
                                            <button class="btn btn-outline-danger w-100">
                                                Remove
                                            </button>
                                        </form>
                                    </th>
                                </tr>
                            }
                        }
                    </table>
                </div>
            </div>
        </div>
    </div>
</div>


<script>
    // chưa hiểu lắm logic phần này // quan trọng phần nào cần nhận gửi những gì truyền cái gì quy tắc truyền là gì truyền như thế nào khi nào truyền // lại có những quy tắc nào để cho solid hơn 
    function enableEditing(id){
        var nameInput = document.getElementById("name-input-"+id)
        var descriptionInput = document.getElementById("description-input-"+id)
        var btnEnablEditing = document.getElementById("btn-enabl-editing-"+id)
        var btnSubitEdit = document.getElementById("btn-subit-edit-"+id)
        // nút submit ẩn cho tới khi ấn nút edit 
        
        nameInput.disabled = false;
        
        descriptionInput 
        btnEnablEditing.classList.add("d-none")
        btnSubitEdit.classList.remove("d-none")
        // đang code scrip phần edit trong CRUB 
    }
    function submitEdit(id){
        var nameInput = document.getElementById("name-input-"+id)
        var descriptionInput = document.getElementById("name-input-"+id)
        var name = nameInput.Value;
        var description = nameInput.Value;
        // dùng XHR
        // dùng XML request
        console.log("id="+id);



        var xhr = new XMLHttpRequest();


        xhr.open('POST', 'Mytask/Edit',true);
        xhr.setRequestHeader('Content-Type','application/x-www-form-urleancoded');

        xhr.onload = function(){
            if(xhr.status == 200){
                try{
                    var response = JSON.parse(xhr.responseText);
                    if(response.success){
                        alert('Update successfully');
                        window.location.reload();
                    }
                }catch{
                    error.log(e)
                }
            }
        }
        xhr.onerror = function(){
            alert('error throw'); 
        }
        var data = 'id=' + encodeURIComponent(id);
            
    }
</script>